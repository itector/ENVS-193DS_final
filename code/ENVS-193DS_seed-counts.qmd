---
title: "ENVS-193DS_seed-counts"
author: Lena Hicks, Jasmine Toni, Izzy Tector
format: 
  html:
    toc: true
    toc-location: left
    code-fold: true
    theme: yeti
editor: visual
execute: 
  message: false
  warning: false
editor: visual
editor: visual
---

# Problem 2. Seed Counts

## Introduction

In the realm of biological research, understanding the factors that influence seed count is of great significance as it sheds light on the reproductive success and fitness of plant species. In the alpine tundra, results of climate change have included 'shrubification'- an increase in woody shrubs, which affects on the vegetative community are in need of inspection([Mod & Luoto, 2016](https://iopscience.iop.org/article/10.1088/1748-9326/11/12/124028/meta)). This analysis aims to investigate how seed count varies in relation to three key variables: plot type (shrub or open), plant species, and the total number of inflorescences, and to see if a simpler model explaining seed count can be derived. Previous studies have shown shrubs to increase seed bank count in desert areas and that different plant species display varying seed production patterns, where trade-offs may occur between larger seed mass and seed count, which are interesting points to compare to the alpine tundra environment we studied([Filazzola et. al., 2019](https://doi.org/10.1371/journal.pone.0215988); [Paul-Victor & Turnbull, 2009](https://doi.org/10.1371/journal.pone.0006917)). Our null hypothesis is that none of the variables observed, plot type, species, nor number of inflorescences, will have an effect on seed count, and our alternative hypothesis is that at least one of these variables will have a correlation with seed count.

## Methods

```{r loading-packages}
# should haves
library(tidyverse)
library(here)
library(janitor)
library(ggeffects)
library(performance)
library(naniar)
library(skimr)
library(flextable)
library(car)
library(broom)
library(corrplot)
library(AICcmodavg)
library(GGally)
# would be nice to have
library(MuMIn)
library(DHARMa)
#library(equatiomatic)
library(corrplot)
library(MASS) # have to read this in before tidyverse 
library(lme4)
library(glmmTMB)
```

```{r loading-data}
seed_count <- read_csv(here("data", "shrubstudy_seed_ctwt.ms.data.csv")) %>% 
  # make the column names cleaner
  clean_names()
```

```{r data-vis}
ggplot(seed_count, aes(x = nr_seeds)) +
  geom_histogram(bins = 17)+
  labs(x = "Seed Count", y = "Number of Data Samples Taken", caption = "Histogram displaying how many seeds were counted at each data sample. The x axis is\n the seed count and the y axis is amounted of data samples colleccted per each seed count.", hjust = 0.5)
```

```{r pairs-plot}
seed_count %>% 
  select(!species) %>% 
  ggpairs()
```

```{r skim-data}
skim(seed_count)
```

### Building Models

```{r building-models}
# linear model, we know this is wrong
seedmod1 <- lm(nr_seeds ~ treatment + species + total_nr_infl, data = seed_count)

# generalized linear model with Poisson distribution
seedmod2 <- glm(nr_seeds ~ treatment + species + total_nr_infl, data = seed_count, family = "poisson")
seedmod2.a <- glm(nr_seeds ~ treatment + species + total_nr_infl, data = seed_count, family = "poisson")

# generalized linear model with negative binomial distribution
seedmod3 <- glm.nb(nr_seeds ~ treatment + species + total_nr_infl, data = seed_count)
seedmod3.a <- glmmTMB(nr_seeds ~ treatment + species + total_nr_infl, data = seed_count, family = "nbinom2")

# generalized linear model with Poisson distribution and random effect of site
seedmod4 <- glmer(nr_seeds ~ species + total_nr_infl + (1|treatment), data = seed_count, family = "poisson")
seedmod4.a <- glmmTMB(nr_seeds ~ species + total_nr_infl + (1|treatment), data = seed_count, family = "poisson")

# generalized linear model with negative binomial distribution and random effect of site
seedmod5 <- glmer.nb(nr_seeds ~ species + total_nr_infl + (1|treatment), data = seed_count)
seedmod5.a <- glmmTMB(nr_seeds ~ species + total_nr_infl + (1|treatment), data = seed_count, family = "nbinom2")
```

```{r check-assumptions}
# check diagnostics
plot(simulateResiduals(seedmod1)) # bad

plot(simulateResiduals(seedmod2)) # bad

plot(simulateResiduals(seedmod3)) # ok?

plot(simulateResiduals(seedmod4)) # bad

plot(simulateResiduals(seedmod5)) # bad/ok?
```

```{r AICc-assumptions}
MuMIn::model.sel(seedmod1, seedmod2, seedmod3, seedmod4, seedmod5)
```

```{r}
seedmod3
```

```{r}
summary(seedmod3)
```

```{r}
confint(seedmod3)
```

```{r}
# adjusted R2
r.squaredGLMM(seedmod3)
```

```{r flextable}
# model object in table
seedmod3 %>% 
  as_flextable()
```

```{r null-model-comparison}
# Overall test of the model's significance
null_model <- glm.nb(nr_seeds ~ 1, data = seed_count) 
# Null model with only intercept
anova(seedmod3, null_model, test = "Chisq")

```

```{r simple-model-vis}
plot(ggpredict(seedmod3, terms = "treatment", back.transform = TRUE), add.data = TRUE)
plot(ggpredict(seedmod3, terms = "species", back.transform = TRUE), add.data = TRUE)
plot(ggpredict(seedmod3, terms = "total_nr_infl", back.transform = TRUE), add.data = TRUE)
```

```{r simpler-models}
seedmod_treatment <- lm(nr_seeds ~ treatment, data = seed_count)
seedmod_species <- lm(nr_seeds ~ species, data = seed_count)
seedmod_total_nr_infl <- lm(nr_seeds ~ total_nr_infl, data = seed_count)
```

```{r AICc-simple-models}
MuMIn::model.sel(seedmod3,null_model,seedmod_treatment,seedmod_species,seedmod_total_nr_infl)
```

All of the simpler models have a higher AIC value

## Results

The results of doing a Chi Square test on the seedmod3 model (created with generalized linear model with negative binomial distribution) it was found that the seedmod3 was the best model of the five that were tested as the Chi-square value using a significance value of 0.05 for the seedmod3 was 178.6161 as seen in the ANOVA table. The degrees of freedom were 181 for the null model and 174 for the full model, the p-value for the full model was indicated to be \<0.001 in the ANOVA table.

Then, based on seedmod3 simpler models were tested with predictors of only one of the variables instead of the full model (seedmod3) like seedmod_treatment. Comparing these models showed that the best fit model to the data based on the lowest AICc value was the seedmod3. The AICc value for the simple models (total_nr_infl = 1295.6, species = 1722.1, treatment = 1741.6) were all larger than the seedmod3's AICc value (1132.0). This showed that there was no simpler model for this data frame to predict the seed count based on the AICc values.

### Visualization

```{r results-vis}
ggplot(data = seedmod3, aes(x = species, y = nr_seeds, fill = treatment)) +
  geom_boxplot(position = position_dodge(width = 0.8), color = "black") +
  labs(x = "Species", y = "Seed Count", title = "Distribution of Seed Count by Species and Treatment") +
  theme_minimal()

ggplot(data = seedmod3, aes(x = total_nr_infl, y = nr_seeds)) +
  geom_point() +
  labs(x = "Total Number of Inflorescences", y = "Seed Count", title = "Relationship between Seed Count and Total Number of Inflorescences") +
  theme_minimal()
```

```{r table}
table <- tidy(seedmod3, conf.int = TRUE) %>% 
  # change the p-value numbers if they're really small using mutate
  # change the estimates, st err, and t-stats to round to ___ digits
  mutate(p.value = round(p.value, digits = 4),
         estimate = round(estimate, digits = 4),
         std.error = round(std.error, digits = 4)) %>% 
  # make it into a flextable
  flextable() %>% 
  # fit it to the viewer
  autofit()

table
```

The table summarizes the statistical results for the predictors in the model. "treatmentshrub" has a significant negative effect (p = 0.016), while "speciesCARRUP" and "total_nr_infl" have significant positive effects (p \< 0.001). "speciesTRIDAS" also has a significant positive effect (p = 0.042). Other predictors do not show significant effects. The table provides key information on the relationships between predictors and seed count

## Works Cited

1.  Filazzola, A., Liczner, A. R., Westphal, M., & Lortie, C. J. (2019). Shrubs indirectly increase desert seedbanks through facilitation of the plant community. PloS one, 14(4), e0215988. <https://doi.org/10.1371/journal.pone.0215988>
2.  Mod, H. K., & Luoto, M. (2016). Arctic shrubification mediates the impacts of warming climate on changes to tundra vegetation. Environmental Research Letters, 11(12). DOI 10.1088/1748-9326/11/12/124028
3.  Paul-Victor, C., & Turnbull, L. A. (2009). The effect of growth conditions on the seed size/number trade-off. PloS one, 4(9), e6917. <https://doi.org/10.1371/journal.pone.0006917>
