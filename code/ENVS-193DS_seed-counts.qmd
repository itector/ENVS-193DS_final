---
title: "ENVS-193DS_seed-counts"
author: Lena Hicks, Jasmine Toni, Izzy Tector
format: 
  html:
    toc: true
    toc-location: left
    code-fold: true
    theme: yeti
editor: visual
execute: 
  message: false
  warning: false
editor: visual
editor: visual
---

# Problem 2. Seed Counts

## Introduction

In the realm of biological research, understanding the factors that influence seed count is of great significance as it sheds light on the reproductive success and fitness of plant species. In the alpine tundra, results of climate change have included 'shrubification'- an increase in woody shrubs, which affects on the vegetative community are in need of inspection([Mod & Luoto, 2016](https://iopscience.iop.org/article/10.1088/1748-9326/11/12/124028/meta)). This analysis aims to investigate how seed count varies in relation to three key variables: plot type (shrub or open), plant species, and the total number of inflorescences, and to see if a simpler model explaining seed count can be derived. Previous studies have shown shrubs to increase seed bank count in desert areas and that different plant species display varying seed production patterns, where trade-offs may occur between larger seed mass and seed count, which are interesting points to compare to the alpine tundra environment we studied([Filazzola et. al., 2019](https://doi.org/10.1371/journal.pone.0215988); [Paul-Victor & Turnbull, 2009](https://doi.org/10.1371/journal.pone.0006917)). Our null hypothesis is that none of the variables observed, plot type, species, nor number of inflorescences, will have an effect on seed count, and our alternative hypothesis is that at least one of these variables will have a correlation with seed count.

## Methods

```{r loading-packages}
# should haves
library(tidyverse)
library(here)
library(janitor)
library(ggeffects)
library(performance)
library(naniar)
library(skimr)
library(flextable)
library(car)
library(broom)
library(corrplot)
library(AICcmodavg)
library(GGally)
# would be nice to have
library(MuMIn)
library(DHARMa)
#library(equatiomatic)
library(corrplot)
library(MASS) # have to read this in before tidyverse 
library(lme4)
library(glmmTMB)
```

```{r loading-data}
seed_count <- read_csv(here("data", "shrubstudy_seed_ctwt.ms.data.csv")) %>% 
  # make the column names cleaner
  clean_names()
```

```{r data-vis}
ggplot(seed_count, aes(x = nr_seeds)) +
  geom_histogram(bins = 17)+
  labs(x = "Seed Count", y = "Number of Data Samples Taken", caption = "Histogram displaying how many seeds were counted at each data sample. The x axis is\n the seed count and the y axis is amounted of data samples colleccted per each seed count.", hjust = 0.5)
```

```{r pairs-plot}
seed_count %>% 
  select(!species) %>% 
  ggpairs()
```

```{r skim-data}
skim(seed_count)
```

### Building Models

```{r building-models}
# linear model, we know this is wrong
seedmod1 <- lm(nr_seeds ~ treatment + species + total_nr_infl, data = seed_count)

# generalized linear model with Poisson distribution
seedmod2 <- glm(nr_seeds ~ treatment + species + total_nr_infl, data = seed_count, family = "poisson")
seedmod2.a <- glm(nr_seeds ~ treatment + species + total_nr_infl, data = seed_count, family = "poisson")

# generalized linear model with negative binomial distribution
seedmod3 <- glm.nb(nr_seeds ~ treatment + species + total_nr_infl, data = seed_count)
seedmod3.a <- glmmTMB(nr_seeds ~ treatment + species + total_nr_infl, data = seed_count, family = "nbinom2")

# generalized linear model with Poisson distribution and random effect of site
seedmod4 <- glmer(nr_seeds ~ species + total_nr_infl + (1|treatment), data = seed_count, family = "poisson")
seedmod4.a <- glmmTMB(nr_seeds ~ species + total_nr_infl + (1|treatment), data = seed_count, family = "poisson")

# generalized linear model with negative binomial distribution and random effect of site
seedmod5 <- glmer.nb(nr_seeds ~ species + total_nr_infl + (1|treatment), data = seed_count)
seedmod5.a <- glmmTMB(nr_seeds ~ species + total_nr_infl + (1|treatment), data = seed_count, family = "nbinom2")
```

```{r check-assumptions}
# check diagnostics
plot(simulateResiduals(seedmod1)) # bad

plot(simulateResiduals(seedmod2)) # bad

plot(simulateResiduals(seedmod3)) # ok?

plot(simulateResiduals(seedmod4)) # bad

plot(simulateResiduals(seedmod5)) # bad/ok?
```

```{r AICc-assumptions}
MuMIn::model.sel(seedmod1, seedmod2, seedmod3, seedmod4, seedmod5)
```

```{r}
seedmod3
```

```{r}
summary(seedmod3)
```

```{r}
confint(seedmod3)
```

```{r}
# adjusted R2
r.squaredGLMM(seedmod3)
```

```{r flextable}
# model object in table
seedmod3 %>% 
  as_flextable()
```

```{r null-model-comparison}
# Overall test of the model's significance
null_model <- glm.nb(nr_seeds ~ 1, data = seed_count) 
# Null model with only intercept
anova(seedmod3, null_model, test = "Chisq")

```

```{r simple-model-vis}
plot(ggpredict(seedmod3, terms = "treatment", back.transform = TRUE), add.data = TRUE)
plot(ggpredict(seedmod3, terms = "species", back.transform = TRUE), add.data = TRUE)
plot(ggpredict(seedmod3, terms = "total_nr_infl", back.transform = TRUE), add.data = TRUE)
```

```{r simpler-models}
seedmod_treatment <- lm(nr_seeds ~ treatment, data = seed_count)
seedmod_species <- lm(nr_seeds ~ species, data = seed_count)
seedmod_total_nr_infl <- lm(nr_seeds ~ total_nr_infl, data = seed_count)
```

```{r AICc-simple-models}
MuMIn::model.sel(seedmod3,null_model,seedmod_treatment,seedmod_species,seedmod_total_nr_infl)
```

All of the simpler models have a higher AIC value

## Results

## Works Cited

1.  Filazzola, A., Liczner, A. R., Westphal, M., & Lortie, C. J. (2019). Shrubs indirectly increase desert seedbanks through facilitation of the plant community. PloS one, 14(4), e0215988. <https://doi.org/10.1371/journal.pone.0215988>
2.  Mod, H. K., & Luoto, M. (2016). Arctic shrubification mediates the impacts of warming climate on changes to tundra vegetation. Environmental Research Letters, 11(12). DOI 10.1088/1748-9326/11/12/124028
3.  Paul-Victor, C., & Turnbull, L. A. (2009). The effect of growth conditions on the seed size/number trade-off. PloS one, 4(9), e6917. <https://doi.org/10.1371/journal.pone.0006917>
